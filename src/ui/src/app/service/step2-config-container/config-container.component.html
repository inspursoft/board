<div class="select-image-container">
  <div class="image-source-container">
    <span class="base-text">{{"SERVICE.STEP_2_SELECT_IMAGE_SOURCE" | translate}}:</span>
    <div class="btn-group base-margin-left">
      <button class="btn" [class.btn-primary]="curContainerType === 0" (click)="changeContainerType(0)">
        Containers
      </button>
      <button class="btn" [class.btn-primary]="curContainerType === 1" (click)="changeContainerType(1)">
        Init containers
      </button>
    </div>
  </div>
  <div *ngFor="let container of curStep2Data.containerList;let iBuf = index" class="dynamic-container">
    <div class="dynamic-line-container">
      <div class="dynamic-icon-container">
        <clr-icon shape="minus"
                  class="dynamic-icon"
                  [class.disabled]="iBuf == 0 && curContainerType === 0"
                  (click)="minusSelectImage(iBuf)"></clr-icon>
      </div>
      <lib-dropdown-ex class="base-margin-left"
                       [dropdownMinWidth]="300"
                       [dropdownItems]="imageSourceList"
                       [dropdownTip]="'SERVICE.STEP_2_SELECT_IMAGE' | translate"
                       [dropdownKey]="'image_name'"
                       [dropdownActiveItem]="getActiveImage(iBuf)"
                       [dropdownItemSelectEnableFn]="canChangeSelectImageFun"
                       (dropdownChangeItem)="changeSelectImage(iBuf, $event)"
                       (dropdownEspecialClick)="createNewCustomImage(iBuf)">
        <ng-template libEspecialTemp>
          <span style="color: blue">{{"SERVICE.STEP_2_CREATE_IMAGE" | translate}}</span>
        </ng-template>
      </lib-dropdown-ex>
      <button class="btn btn-default get-tag"
              (click)="getImageDetailList(container.image.image_name).subscribe()"
              *ngIf="imageTagNotReadyList.get(container)">
        {{"SERVICE.STEP_2_GET_IMAGE_TAG"|translate}}
      </button>
      <lib-dropdown-ex class="base-margin-left"
                       *ngIf="imageDetailSourceList.get(container.image.image_name)"
                       [dropdownMinWidth]="150"
                       [dropdownTip]="container.image.image_tag"
                       [dropdownItems]="imageDetailSourceList.get(container.image.image_name)"
                       [dropdownKey]="'image_tag'"
                       (dropdownChangeItem)="changeSelectImageDetail(container.image.image_name,$event)">
      </lib-dropdown-ex>
      <a href="javascript:void(0)">
        <clr-icon *ngIf="imageDetailSourceList.get(container.image.image_name)"
                  shape="wrench"
                  class="action"
                  (click)="toggleContainerEditStatus(container)">
        </clr-icon>
      </a>
    </div>
    <div class="config-container" *ngIf="containerIsInEdit.get(container)">
      <lib-input-ex [inputLabel]="'SERVICE.STEP_2_CONTAINER_NAME' | translate"
                    [inputIsRequired]="true"
                    [inputPattern]="patternContainerName"
                    [inputDefaultValue]="container.name"
                    [validatorMessage]="[{key:'pattern',message:'SERVICE.STEP_2_CONTAINER_NAME_PATTERN_NSG' | translate}]"
                    (commitEvent)="container.name = $event"></lib-input-ex>
      <lib-input-ex [inputLabel]="'SERVICE.STEP_2_WORKING_DIR' | translate"
                    [inputPattern]="patternWorkdir"
                    [inputDefaultValue]="container.working_dir"
                    [inputPlaceholder]="'SERVICE.STEP_2_WORK_DIRECTOR'| translate"
                    (commitEvent)="container.working_dir = $event"></lib-input-ex>
      <lib-input-ex [inputType]="2"
                    [inputLabel]="'SERVICE.STEP_2_VOLUME_MOUNTS' | translate"
                    [inputDefaultValue]="getVolumesDescription(0, container)"
                    [inputPlaceholder]="'SERVICE.STEP_2_STORAGE_VOLUME'| translate"
                    (editEvent)="editVolumeMount(container)"></lib-input-ex>
      <div *ngIf="container.volume_mounts.length > 1" class="volume-info-container">
        <span *ngFor="let _ of container.volume_mounts; let i = index">
          <span *ngIf="i > 0">{{getVolumesDescription(i, container)}}</span>
        </span>
      </div>
      <lib-input-ex [inputType]="2"
                    [inputLabel]="'SERVICE.STEP_2_Env' | translate"
                    [inputDefaultValue]="getEnvsDescription(container)"
                    [inputPlaceholder]="'SERVICE.STEP_2_ENVIRONMENT_VARIABLES'| translate"
                    (editEvent)="editEnvironment(container)"></lib-input-ex>
      <lib-input-array-ex [inputCategory]="'number'"
                          [inputArrayFixed]="fixedContainerPort.get(container)"
                          [inputMin]="1"
                          [inputArrayDefault]="container.container_port"
                          [inputMax]="65535"
                          [inputPlaceholder]="'[1..65535]'"
                          [inputLabel]="'SERVICE.STEP_2_CONTAINER_PORT' | translate"
                          (commitEvent)="container.container_port = $event">
      </lib-input-array-ex>
      <lib-input-ex [inputLabel]="'SERVICE.STEP_2_COMMAND' | translate"
                    [inputDefaultValue]="container.command"
                    [inputPlaceholder]="'SERVICE.STEP_2_COMMAND'| translate"
                    (commitEvent)="container.command = $event"></lib-input-ex>
      <lib-input-ex *ngIf="curContainerType === 0"
                    [inputLabel]="'SERVICE.STEP_2_CPU_REQUEST' | translate"
                    [inputPattern]="patternCpuRequest"
                    [inputDefaultValue]="container.cpu_request"
                    [inputPlaceholder]="'eg. 100m'"
                    [validatorAsyncFn]="checkSetCpuRequestFun"
                    [validatorMessage]="[{key:'beyondMaxLimit',message: 'SERVICE.STEP_2_BEYOND_MAX_VALUE' | translate}]"
                    (commitEvent)="container.cpu_request = $event"></lib-input-ex>
      <lib-input-ex *ngIf="curContainerType === 0"
                    [inputLabel]="'SERVICE.STEP_2_MEMORY_REQUEST' | translate"
                    [inputPattern]="patternMemRequest"
                    [validatorAsyncFn]="checkSetMemRequestFun"
                    [inputDefaultValue]="container.mem_request"
                    [inputPlaceholder]="'eg. 100Mi'"
                    [validatorMessage]="[{key:'beyondMaxLimit',message: 'SERVICE.STEP_2_BEYOND_MAX_VALUE' | translate}]"
                    (commitEvent)="container.mem_request = $event"></lib-input-ex>
      <lib-input-ex *ngIf="curContainerType === 0"
                    [inputLabel]="'SERVICE.STEP_2_CPU_LIMIT' | translate"
                    [inputDefaultValue]="container.cpu_limit"
                    [inputPlaceholder]="'eg. 1024m'"
                    [inputPattern]="patternCpuLimit"
                    (commitEvent)="container.cpu_limit = $event"></lib-input-ex>
      <lib-input-ex *ngIf="curContainerType === 0"
                    [inputLabel]="'SERVICE.STEP_2_MEMORY_LIMIT' | translate"
                    [inputDefaultValue]="container.mem_limit"
                    [inputPattern]="patternMemLimit"
                    [inputPlaceholder]="'eg. 1024Mi'"
                    (commitEvent)="container.mem_limit = $event"></lib-input-ex>
    </div>
  </div>
  <div class="plus-container">
    <clr-icon class="dynamic-icon" shape="plus" (click)="addEmptyWorkItem()"></clr-icon>
    <span class="base-margin-left">{{"SERVICE.STEP_2_ADD_NEW_IMAGE_DES"|translate}}</span>
  </div>
</div>
<button class="btn btn-default" (click)="cancelBuildService()">
  {{"BUTTON.CANCEL"|translate}}
</button>
<button class="btn btn-default" (click)="backStep()">
  {{"BUTTON.BACK" | translate}}
</button>
<button class="btn btn-default" [disabled]="!isCanNextStep" (click)="forward()">
  {{"BUTTON.NEXT"|translate}}
</button>
<environment-value *ngIf="showEnvironmentValue"
                   [isProvideBindConfigMap]="true"
                   [projectName]="serviceStep2Data.projectName"
                   [inputEnvsData]="getDefaultEnvsData()"
                   [inputFixedKeyList]="getDefaultEnvsFixedData()"
                   (closeNotification)="showEnvironmentValue = false"
                   (onConfirm)="setEnvironment($event)">
</environment-value>
