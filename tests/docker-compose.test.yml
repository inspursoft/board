version: '2'
services:
  db:
    build: 
      context: ../../
      dockerfile: make/dev/container/db/Dockerfile
    restart: always
    volumes:
      - /data/board/database:/var/lib/mysql
    env_file:
      - ../config/db/env
    ports:
      - 3306:3306
  openldap:
    image: osixia/openldap:1.1.11
    restart: always
    volumes:
      - ./ldap_test.ldif:/container/service/slapd/assets/config/bootstrap/ldif/custom/ldap_test.ldif
    command: --copy-service
    ports:
      - 389:389
      - 636:636
  tokenserver:
    build:
      context: ../../
      dockerfile: make/dev/container/tokenserver/Dockerfile
    image: dev_tokenserver:dev
    env_file:
      - ../config/tokenserver/env
    restart: always

    ports:
      - 4000:4000
  registry:
    image: registry:latest
    restart: always
    volumes:
      - /data/registry:/tmp/registry
    environment:
      REGISTRY_STORAGE_DELETE_ENABLED: 'true'
    ports:
      - 5000:5000
  gogits:
    build:
      context: ../../
      dockerfile: make/dev/container/gogits/Dockerfile
    image: dev_gogits:dev
    restart: always
    volumes:
      - ../config/gogits/conf/app.ini:/tmp/conf/app.ini
      - /data/board/gogits:/data:rw
    ports:
      - "10022:22"
      - "10080:3000"
  gomail:    
    image: 10.111.25.119/board/dev_gomail:dev
    restart: always
    ports:
      - "12225:12225"
  jenkins:
    build:
      context: ../../
      dockerfile: make/dev/container/jenkins/Dockerfile
    image: dev_jenkins:dev
    restart: always
    volumes:
      - /data/board/jenkins_home:/var/jenkins_home
      - ../config/ssh_keys:/root/.ssh
      - /var/run/docker.sock:/var/run/docker.sock
      - /usr/local/bin/docker:/usr/bin/docker
    environment:
      - jenkins_host_ip=127.0.0.1
      - jenkins_host_port=8888
      - jenkins_node_ip=127.0.0.1
      - jenkins_node_ssh_port=22
      - jenkins_node_username=root
      - jenkins_node_password=123456a?
      - jenkins_node_volume=/data/jenkins_node
    ports:
      - 8888:8080
      - 50000:50000

